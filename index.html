<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Wiki engine</title>
    <link rel="stylesheet" href="index.css" />
    <script>
      const DATA = {};
    </script>
    <script src="bin/time.js"></script>

    <script src="database.js"></script>
  </head>

  <body>
    <header></header>
    <div class="black-filter header-fullgrid">
      <img class="header-image" src="#" alt="" />
    </div>
    <main>
      <span class="header-parentgrid"></span>
      <h1 class="header-titlegrid"></h1>
      <div class="content__text"></div>
    </main>
    <nav class="mainnav"></nav>
  </body>

  <script>
    //Parsing database
    const database = JSON.parse(DATA.content);

    //Hash
    const currentHash = getCurrentHash();
    setHashContent();
    createMenu();

    //Detect current page
    function getCurrentHash() {
      return window.location.hash.slice(1);
    }

    //Get hash, check if empty, return
    function setHashContent() {
      let hash = getCurrentHash();
      console.log({
        hash
      });
      if (database.content[hash]) {
        addContentToPage(database.content[hash]);
      } else if (hash.length === 0 || hash === "#") {
        addContentToPage(database.content["home"]);
      } else {
        addContentToPage(database.content["404"]);
      }
    }

    //Writing content into page
    function addContentToPage(pageContent) {
      console.log({
        pageContent
      });
      let contentEl = document.querySelector(".content__text");
      contentEl.innerHTML = pageContent["text"];

      let imageEl = document.querySelector(".header-image");
      imageEl.setAttribute("src", pageContent["img"]);

      let titleEl = document.querySelector(".header-titlegrid");
      titleEl.innerHTML = pageContent["title"];

      let parentEl = document.querySelector(".header-parentgrid");
      parentEl.innerHTML = `This page is part of the <a href="#${pageContent["parent"]}">${pageContent["parent"]}</a> group`;

      window.scrollTo(0, 0);
    }

    //Create menu from pages
    function createMenu() {
      const ul = document.createElement("ul");
      document.querySelector(".mainnav").appendChild(ul);

      for (var i in database.content) {
        let link = `<a href="#${i}">${i}</a>`;
        let li = document.createElement("li");
        ul.appendChild(li);
        li.innerHTML += link;
      }
    }

    //Watch for url change
    window.onhashchange = function() {
      setHashContent();
    };
  </script>
</html>
